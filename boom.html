<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¶“å…¸æƒé›·éŠæˆ²</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 800px;
            width: 100%;
        }

        .game-header {
            text-align: center;
            margin-bottom: 25px;
            color: white;
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            color: white;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .info-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .info-value {
            font-size: 1.8rem;
            font-weight: bold;
            min-width: 70px;
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        #minesCount {
            color: #ff6b6b;
        }

        #timer {
            color: #4ecdc4;
        }

        #flagsCount {
            color: #45b7d1;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 25px;
        }

        .difficulty-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .difficulty-btn:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.2);
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .game-board {
            display: grid;
            gap: 2px;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 12px;
            margin: 0 auto;
            width: fit-content;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .cell {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #4a6491, #2c3e50);
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .cell:hover {
            background: linear-gradient(135deg, #5a749b, #3c4e60);
            transform: scale(1.05);
        }

        .cell.revealed {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.05);
        }

        .cell.flagged {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        }

        .cell.mine {
            background: linear-gradient(135deg, #ff6b6b, #ff4757);
        }

        .cell.mine.revealed {
            background: linear-gradient(135deg, #ff4757, #ff6b6b);
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .cell.number-1 { color: #4ecdc4; }
        .cell.number-2 { color: #45b7d1; }
        .cell.number-3 { color: #96ceb4; }
        .cell.number-4 { color: #ffeaa7; }
        .cell.number-5 { color: #fab1a0; }
        .cell.number-6 { color: #ff7675; }
        .cell.number-7 { color: #fd79a8; }
        .cell.number-8 { color: #a29bfe; }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }

        .control-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .control-btn#restartBtn {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        .control-btn#hintBtn {
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
        }

        .game-status {
            text-align: center;
            margin-top: 20px;
            min-height: 40px;
        }

        #statusMessage {
            font-size: 1.3rem;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .win {
            color: #4ecdc4;
            background: rgba(78, 205, 196, 0.1);
            animation: celebrate 2s ease-in-out;
        }

        .lose {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .instructions {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin-top: 25px;
            color: rgba(255, 255, 255, 0.9);
        }

        .instructions h3 {
            color: #feb47b;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .instructions ul {
            list-style-type: none;
            padding-left: 0;
        }

        .instructions li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .instructions li:before {
            content: "â€¢";
            color: #4ecdc4;
            font-size: 1.5rem;
            position: absolute;
            left: 0;
            top: -5px;
        }

        .flag-icon {
            font-size: 0.9rem;
        }

        .mine-icon {
            font-size: 1rem;
        }

        @media (max-width: 768px) {
            .cell {
                width: 30px;
                height: 30px;
                font-size: 1rem;
            }
            
            .game-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .difficulty-selector {
                flex-wrap: wrap;
            }
            
            h1 {
                font-size: 2.2rem;
            }
        }

        @media (max-width: 480px) {
            .cell {
                width: 25px;
                height: 25px;
                font-size: 0.9rem;
            }
            
            .control-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .game-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>ğŸ’£ ç¶“å…¸æƒé›·éŠæˆ²</h1>
            <p>æ‰¾å‡ºæ‰€æœ‰åœ°é›·ï¼Œæ¨™è¨˜æ­£ç¢ºä½ç½®å³å¯ç²å‹ï¼</p>
        </div>

        <div class="game-info">
            <div class="info-item">
                <div class="info-label">åœ°é›·æ•¸é‡</div>
                <div class="info-value" id="minesCount">10</div>
            </div>
            <div class="info-item">
                <div class="info-label">éŠæˆ²æ™‚é–“</div>
                <div class="info-value" id="timer">000</div>
            </div>
            <div class="info-item">
                <div class="info-label">æ——å­æ•¸é‡</div>
                <div class="info-value" id="flagsCount">0</div>
            </div>
        </div>

        <div class="difficulty-selector">
            <button class="difficulty-btn active" data-difficulty="easy">åˆç´š (9Ã—9)</button>
            <button class="difficulty-btn" data-difficulty="medium">ä¸­ç´š (16Ã—16)</button>
            <button class="difficulty-btn" data-difficulty="hard">é«˜ç´š (16Ã—30)</button>
            <button class="difficulty-btn" data-difficulty="custom">è‡ªè¨‚</button>
        </div>

        <div id="gameBoard" class="game-board"></div>

        <div class="game-status">
            <div id="statusMessage"></div>
        </div>

        <div class="controls">
            <button class="control-btn" id="restartBtn">ğŸ”„ é‡æ–°é–‹å§‹</button>
            <button class="control-btn" id="hintBtn">ğŸ’¡ æç¤º (å‰©é¤˜: <span id="hintCount">3</span>)</button>
            <button class="control-btn" id="autoFlagBtn">ğŸš© è‡ªå‹•æ¨™è¨˜</button>
        </div>

        <div class="instructions">
            <h3>ğŸ® éŠæˆ²èªªæ˜</h3>
            <ul>
                <li><strong>å·¦éµé»æ“Š</strong>: æ‰“é–‹æ ¼å­ï¼Œé¡¯ç¤ºæ•¸å­—æˆ–åœ°é›·</li>
                <li><strong>å³éµé»æ“Š</strong>: æ¨™è¨˜/å–æ¶ˆæ¨™è¨˜åœ°é›·ä½ç½®ï¼ˆæ——å­ï¼‰</li>
                <li><strong>é›™æ“Šæ•¸å­—</strong>: å¦‚æœå‘¨åœå·²æ¨™è¨˜è¶³å¤ æ——å­ï¼Œè‡ªå‹•æ‰“é–‹å‘¨åœæ ¼å­</li>
                <li><strong>æ•¸å­—æ„ç¾©</strong>: è¡¨ç¤ºå‘¨åœ8æ ¼ä¸­æœ‰å¤šå°‘å€‹åœ°é›·</li>
                <li><strong>ç²å‹æ¢ä»¶</strong>: æ‰“é–‹æ‰€æœ‰éåœ°é›·æ ¼å­æˆ–æ­£ç¢ºæ¨™è¨˜æ‰€æœ‰åœ°é›·</li>
            </ul>
        </div>
    </div>

    <script>
        // éŠæˆ²é…ç½®
        const DIFFICULTIES = {
            easy: { rows: 9, cols: 9, mines: 10 },
            medium: { rows: 16, cols: 16, mines: 40 },
            hard: { rows: 16, cols: 30, mines: 99 },
            custom: { rows: 9, cols: 9, mines: 10 }
        };

        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            difficulty: 'easy',
            rows: 9,
            cols: 9,
            mines: 10,
            board: [],
            revealed: [],
            flagged: [],
            gameOver: false,
            gameWon: false,
            gameStarted: false,
            startTime: null,
            timerInterval: null,
            elapsedTime: 0,
            flagsUsed: 0,
            hintsRemaining: 3
        };

        // DOM å…ƒç´ 
        const gameBoard = document.getElementById('gameBoard');
        const minesCount = document.getElementById('minesCount');
        const timer = document.getElementById('timer');
        const flagsCount = document.getElementById('flagsCount');
        const statusMessage = document.getElementById('statusMessage');
        const hintCount = document.getElementById('hintCount');
        const restartBtn = document.getElementById('restartBtn');
        const hintBtn = document.getElementById('hintBtn');
        const autoFlagBtn = document.getElementById('autoFlagBtn');
        const difficultyBtns = document.querySelectorAll('.difficulty-btn');

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            const config = DIFFICULTIES[gameState.difficulty];
            gameState.rows = config.rows;
            gameState.cols = config.cols;
            gameState.mines = config.mines;
            
            // é‡ç½®éŠæˆ²ç‹€æ…‹
            gameState.board = Array(gameState.rows).fill().map(() => Array(gameState.cols).fill(0));
            gameState.revealed = Array(gameState.rows).fill().map(() => Array(gameState.cols).fill(false));
            gameState.flagged = Array(gameState.rows).fill().map(() => Array(gameState.cols).fill(false));
            gameState.gameOver = false;
            gameState.gameWon = false;
            gameState.gameStarted = false;
            gameState.flagsUsed = 0;
            gameState.elapsedTime = 0;
            gameState.hintsRemaining = 3;
            
            // æ¸…é™¤è¨ˆæ™‚å™¨
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
                gameState.timerInterval = null;
            }
            
            // æ›´æ–°é¡¯ç¤º
            updateDisplay();
            statusMessage.textContent = 'éŠæˆ²é–‹å§‹ï¼é»æ“Šä»»æ„æ ¼å­é–‹å§‹è¨ˆæ™‚';
            statusMessage.className = '';
            
            // ç”ŸæˆéŠæˆ²æ¿
            generateBoard();
            renderBoard();
        }

        // ç”ŸæˆéŠæˆ²æ¿
        function generateBoard() {
            // éš¨æ©Ÿæ”¾ç½®åœ°é›·
            let minesPlaced = 0;
            while (minesPlaced < gameState.mines) {
                const row = Math.floor(Math.random() * gameState.rows);
                const col = Math.floor(Math.random() * gameState.cols);
                
                if (gameState.board[row][col] !== -1) { // -1 è¡¨ç¤ºåœ°é›·
                    gameState.board[row][col] = -1;
                    minesPlaced++;
                    
                    // æ›´æ–°å‘¨åœæ ¼å­çš„æ•¸å­—
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            const nr = row + dr;
                            const nc = col + dc;
                            
                            if (nr >= 0 && nr < gameState.rows && 
                                nc >= 0 && nc < gameState.cols && 
                                gameState.board[nr][nc] !== -1) {
                                gameState.board[nr][nc]++;
                            }
                        }
                    }
                }
            }
        }

        // æ¸²æŸ“éŠæˆ²æ¿
        function renderBoard() {
            gameBoard.innerHTML = '';
            gameBoard.style.gridTemplateColumns = `repeat(${gameState.cols}, 1fr)`;
            gameBoard.style.gridTemplateRows = `repeat(${gameState.rows}, 1fr)`;
            
            for (let r = 0; r < gameState.rows; r++) {
                for (let c = 0; c < gameState.cols; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    
                    // å¦‚æœæ ¼å­å·²æ‰“é–‹
                    if (gameState.revealed[r][c]) {
                        cell.classList.add('revealed');
                        const value = gameState.board[r][c];
                        
                        if (value === -1) { // åœ°é›·
                            cell.classList.add('mine');
                            cell.innerHTML = 'ğŸ’£';
                        } else if (value > 0) { // æ•¸å­—
                            cell.textContent = value;
                            cell.classList.add(`number-${value}`);
                        }
                    } 
                    // å¦‚æœæ ¼å­è¢«æ¨™è¨˜
                    else if (gameState.flagged[r][c]) {
                        cell.classList.add('flagged');
                        cell.innerHTML = 'ğŸš©';
                    }
                    
                    // æ·»åŠ äº‹ä»¶ç›£è½å™¨
                    cell.addEventListener('click', handleCellClick);
                    cell.addEventListener('contextmenu', handleCellRightClick);
                    cell.addEventListener('dblclick', handleCellDoubleClick);
                    
                    gameBoard.appendChild(cell);
                }
            }
        }

        // è™•ç†æ ¼å­é»æ“Š
        function handleCellClick(event) {
            event.preventDefault();
            const row = parseInt(event.target.dataset.row);
            const col = parseInt(event.target.dataset.col);
            
            if (gameState.gameOver || gameState.gameWon || 
                gameState.revealed[row][col] || gameState.flagged[row][col]) {
                return;
            }
            
            // é–‹å§‹éŠæˆ²è¨ˆæ™‚
            if (!gameState.gameStarted) {
                startGameTimer();
                gameState.gameStarted = true;
                statusMessage.textContent = 'éŠæˆ²é€²è¡Œä¸­...';
            }
            
            // æ‰“é–‹æ ¼å­
            revealCell(row, col);
            
            // æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸ
            checkGameStatus();
        }

        // è™•ç†æ ¼å­å³éµé»æ“Šï¼ˆæ¨™è¨˜æ——å­ï¼‰
        function handleCellRightClick(event) {
            event.preventDefault();
            const row = parseInt(event.target.dataset.row);
            const col = parseInt(event.target.dataset.col);
            
            if (gameState.gameOver || gameState.gameWon || gameState.revealed[row][col]) {
                return;
            }
            
            // é–‹å§‹éŠæˆ²è¨ˆæ™‚
            if (!gameState.gameStarted) {
                startGameTimer();
                gameState.gameStarted = true;
                statusMessage.textContent = 'éŠæˆ²é€²è¡Œä¸­...';
            }
            
            // åˆ‡æ›æ——å­æ¨™è¨˜
            gameState.flagged[row][col] = !gameState.flagged[row][col];
            if (gameState.flagged[row][col]) {
                gameState.flagsUsed++;
            } else {
                gameState.flagsUsed--;
            }
            
            updateDisplay();
            renderBoard();
            checkGameStatus();
        }

        // è™•ç†æ ¼å­é›™æ“Š
        function handleCellDoubleClick(event) {
            event.preventDefault();
            const row = parseInt(event.target.dataset.row);
            const col = parseInt(event.target.dataset.col);
            
            if (gameState.gameOver || gameState.gameWon || 
                !gameState.revealed[row][col] || gameState.board[row][col] <= 0) {
                return;
            }
            
            // è¨ˆç®—å‘¨åœæ——å­æ•¸é‡
            let flagCount = 0;
            for (let dr = -1; dr <= 1; dr++) {
                for (let dc = -1; dc <= 1; dc++) {
                    const nr = row + dr;
                    const nc = col + dc;
                    
                    if (nr >= 0 && nr < gameState.rows && 
                        nc >= 0 && nc < gameState.cols && 
                        gameState.flagged[nr][nc]) {
                        flagCount++;
                    }
                }
            }
            
            // å¦‚æœæ——å­æ•¸é‡ç­‰æ–¼æ ¼å­æ•¸å­—ï¼Œæ‰“é–‹å‘¨åœæ ¼å­
            if (flagCount === gameState.board[row][col]) {
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        const nr = row + dr;
                        const nc = col + dc;
                        
                        if (nr >= 0 && nr < gameState.rows && 
                            nc >= 0 && nc < gameState.cols && 
                            !gameState.revealed[nr][nc] && 
                            !gameState.flagged[nr][nc]) {
                            revealCell(nr, nc);
                        }
                    }
                }
                
                checkGameStatus();
            }
        }

        // æ‰“é–‹æ ¼å­ï¼ˆéæ­¸æ‰“é–‹ç©ºç™½æ ¼å­ï¼‰
        function revealCell(row, col) {
            if (row < 0 || row >= gameState.rows || 
                col < 0 || col >= gameState.cols || 
                gameState.revealed[row][col] || 
                gameState.flagged[row][col]) {
                return;
            }
            
            gameState.revealed[row][col] = true;
            
            // å¦‚æœæ˜¯ç©ºç™½æ ¼å­ï¼Œéæ­¸æ‰“é–‹å‘¨åœæ ¼å­
            if (gameState.board[row][col] === 0) {
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        if (dr !== 0 || dc !== 0) {
                            revealCell(row + dr, col + dc);
                        }
                    }
                }
            }
            
            renderBoard();
        }

        // é–‹å§‹éŠæˆ²è¨ˆæ™‚å™¨
        function startGameTimer() {
            gameState.startTime = Date.now();
            gameState.timerInterval = setInterval(() => {
                gameState.elapsedTime = Math.floor((Date.now() - gameState.startTime) / 1000);
                updateDisplay();
            }, 1000);
        }

        // æª¢æŸ¥éŠæˆ²ç‹€æ…‹
        function checkGameStatus() {
            // æª¢æŸ¥æ˜¯å¦è¸©åˆ°åœ°é›·
            for (let r = 0; r < gameState.rows; r++) {
                for (let c = 0; c < gameState.cols; c++) {
                    if (gameState.revealed[r][c] && gameState.board[r][c] === -1) {
                        gameOver(false);
                        return;
                    }
                }
            }
            
            // æª¢æŸ¥æ˜¯å¦è´å¾—éŠæˆ²
            let allNonMinesRevealed = true;
            let allMinesFlagged = true;
            
            for (let r = 0; r < gameState.rows; r++) {
                for (let c = 0; c < gameState.cols; c++) {
                    if (gameState.board[r][c] !== -1 && !gameState.revealed[r][c]) {
                        allNonMinesRevealed = false;
                    }
                    if (gameState.board[r][c] === -1 && !gameState.flagged[r][c]) {
                        allMinesFlagged = false;
                    }
                }
            }
            
            if (allNonMinesRevealed || allMinesFlagged) {
                gameOver(true);
            }
        }

        // éŠæˆ²çµæŸ
        function gameOver(isWin) {
            gameState.gameOver = true;
            gameState.gameWon = isWin;
            
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            // é¡¯ç¤ºæ‰€æœ‰åœ°é›·
            for (let r = 0; r < gameState.rows; r++) {
                for (let c = 0; c < gameState.cols; c++) {
                    if (gameState.board[r][c] === -1 && !gameState.flagged[r][c]) {
                        gameState.revealed[r][c] = true;
                    }
                }
            }
            
            renderBoard();
            
            if (isWin) {
                statusMessage.textContent = `ğŸ‰ æ­å–œï¼ä½ è´äº†ï¼ç”¨æ™‚ ${gameState.elapsedTime} ç§’`;
                statusMessage.className = 'win';
                
                // æ’­æ”¾å‹åˆ©éŸ³æ•ˆï¼ˆå¦‚æœæœ‰ï¼‰
                playSound('win');
            } else {
                statusMessage.textContent = 'ğŸ’¥ éŠæˆ²çµæŸï¼ä½ è¸©åˆ°åœ°é›·äº†';
                statusMessage.className = 'lose';
                
                // æ’­æ”¾çˆ†ç‚¸éŸ³æ•ˆï¼ˆå¦‚æœæœ‰ï¼‰
                playSound('explosion');
            }
        }

        // æç¤ºåŠŸèƒ½
        function giveHint() {
            if (gameState.gameOver || gameState.gameWon || 
                gameState.hintsRemaining <= 0) {
                return;
            }
            
            // æ‰¾åˆ°ä¸€å€‹å®‰å…¨çš„æœªæ‰“é–‹æ ¼å­
            const safeCells = [];
            for (let r = 0; r < gameState.rows; r++) {
                for (let c = 0; c < gameState.cols; c++) {
                    if (!gameState.revealed[r][c] && 
                        !gameState.flagged[r][c] && 
                        gameState.board[r][c] !== -1) {
                        safeCells.push({r, c});
                    }
                }
            }
            
            if (safeCells.length > 0) {
                const hint = safeCells[Math.floor(Math.random() * safeCells.length)];
                revealCell(hint.r, hint.c);
                gameState.hintsRemaining--;
                
                // æ·»åŠ è¦–è¦ºæ•ˆæœ
                const cell = document.querySelector(`.cell[data-row="${hint.r}"][data-col="${hint.c}"]`);
                if (cell) {
                    cell.style.animation = 'pulse 1s ease-in-out';
                    setTimeout(() => {
                        cell.style.animation = '';
                    }, 1000);
                }
                
                updateDisplay();
                checkGameStatus();
            }
        }

        // è‡ªå‹•æ¨™è¨˜åŠŸèƒ½
        function autoFlag() {
            if (gameState.gameOver || gameState.gameWon) {
                return;
            }
            
            let flagsAdded = 0;
            
            // æ‰¾åˆ°å¯ä»¥ç¢ºå®šæ˜¯åœ°é›·çš„æ ¼å­
            for (let r = 0; r < gameState.rows; r++) {
                for (let c = 0; c < gameState.cols; c++) {
                    if (gameState.revealed[r][c] && gameState.board[r][c] > 0) {
                        const value = gameState.board[r][c];
                        let hiddenCount = 0;
                        let flagCount = 0;
                        
                        // çµ±è¨ˆå‘¨åœæœªæ‰“é–‹çš„æ ¼å­å’Œæ——å­æ•¸é‡
                        for (let dr = -1; dr <= 1; dr++) {
                            for (let dc = -1; dc <= 1; dc++) {
                                const nr = r + dr;
                                const nc = c + dc;
                                
                                if (nr >= 0 && nr < gameState.rows && 
                                    nc >= 0 && nc < gameState.cols) {
                                    if (!gameState.revealed[nr][nc] && !gameState.flagged[nr][nc]) {
                                        hiddenCount++;
                                    } else if (gameState.flagged[nr][nc]) {
                                        flagCount++;
                                    }
                                }
                            }
                        }
                        
                        // å¦‚æœéš±è—æ ¼å­æ•¸ç­‰æ–¼å·®å€¼ï¼Œæ¨™è¨˜æ‰€æœ‰éš±è—æ ¼å­
                        if (value - flagCount === hiddenCount && hiddenCount > 0) {
                            for (let dr = -1; dr <= 1; dr++) {
                                for (let dc = -1; dc <= 1; dc++) {
                                    const nr = r + dr;
                                    const nc = c + dc;
                                    
                                    if (nr >= 0 && nr < gameState.rows && 
                                        nc >= 0 && nc < gameState.cols &&
                                        !gameState.revealed[nr][nc] && 
                                        !gameState.flagged[nr][nc]) {
                                        gameState.flagged[nr][nc] = true;
                                        gameState.flagsUsed++;
                                        flagsAdded++;
                                    }
                                }
                            }
                        }
                    }
                }
            }
            
            if (flagsAdded > 0) {
                updateDisplay();
                renderBoard();
                checkGameStatus();
                
                // é¡¯ç¤ºæç¤º
                statusMessage.textContent = `å·²è‡ªå‹•æ¨™è¨˜ ${flagsAdded} å€‹åœ°é›·`;
                setTimeout(() => {
                    if (!gameState.gameOver && !gameState.gameWon) {
                        statusMessage.textContent = 'éŠæˆ²é€²è¡Œä¸­...';
                    }
                }, 2000);
            }
        }

        // æ›´æ–°é¡¯ç¤º
        function updateDisplay() {
            minesCount.textContent = gameState.mines.toString().padStart(3, '0');
            timer.textContent = gameState.elapsedTime.toString().padStart(3, '0');
            flagsCount.textContent = gameState.flagsUsed.toString().padStart(3, '0');
            hintCount.textContent = gameState.hintsRemaining;
            
            // æ›´æ–°é›£åº¦æŒ‰éˆ•ç‹€æ…‹
            difficultyBtns.forEach(btn => {
                if (btn.dataset.difficulty === gameState.difficulty) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // æ’­æ”¾éŸ³æ•ˆï¼ˆæ¨¡æ“¬ï¼‰
        function playSound(type) {
            // é€™è£¡å¯ä»¥æ·»åŠ çœŸå¯¦çš„éŸ³æ•ˆæ–‡ä»¶
            console.log(`æ’­æ”¾éŸ³æ•ˆ: ${type}`);
        }

        // äº‹ä»¶ç›£è½å™¨è¨­ç½®
        function setupEventListeners() {
            // é›£åº¦é¸æ“‡
            difficultyBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    gameState.difficulty = btn.dataset.difficulty;
                    initGame();
                });
            });
            
            // é‡æ–°é–‹å§‹æŒ‰éˆ•
            restartBtn.addEventListener('click', initGame);
            
            // æç¤ºæŒ‰éˆ•
            hintBtn.addEventListener('click', giveHint);
            
            // è‡ªå‹•æ¨™è¨˜æŒ‰éˆ•
            autoFlagBtn.addEventListener('click', autoFlag);
            
            // éµç›¤å¿«æ·éµ
            document.addEventListener('keydown', (event) => {
                switch(event.key.toLowerCase()) {
                    case 'r':
                        initGame();
                        break;
                    case 'h':
                        giveHint();
                        break;
                    case 'f':
                        autoFlag();
                        break;
                    case '1':
                        gameState.difficulty = 'easy';
                        initGame();
                        break;
                    case '2':
                        gameState.difficulty = 'medium';
                        initGame();
                        break;
                    case '3':
                        gameState.difficulty = 'hard';
                        initGame();
                        break;
                }
            });
        }

        // åˆå§‹åŒ–éŠæˆ²
        initGame();
        setupEventListeners();

        // æ·»åŠ è‡ªè¨‚é›£åº¦å°è©±æ¡†ï¼ˆç°¡å–®å¯¦ç¾ï¼‰
        const customBtn = document.querySelector('[data-difficulty="custom"]');
        customBtn.addEventListener('click', () => {
            const rows = prompt('è«‹è¼¸å…¥è¡Œæ•¸ (5-30):', '9');
            const cols = prompt('è«‹è¼¸å…¥åˆ—æ•¸ (5-30):', '9');
            const mines = prompt('è«‹è¼¸å…¥åœ°é›·æ•¸é‡:', '10');
            
            if (rows && cols && mines) {
                const r = parseInt(rows);
                const c = parseInt(cols);
                const m = parseInt(mines);
                
                if (r >= 5 && r <= 30 && c >= 5 && c <= 30 && 
                    m >= 1 && m <= r * c * 0.5) {
                    DIFFICULTIES.custom = { rows: r, cols: c, mines: m };
                    gameState.difficulty = 'custom';
                    initGame();
                } else {
                    alert('è¼¸å…¥ç„¡æ•ˆï¼è«‹ç¢ºä¿ï¼š\nè¡Œæ•¸å’Œåˆ—æ•¸åœ¨5-30ä¹‹é–“\nåœ°é›·æ•¸é‡ä¸è¶…éç¸½æ ¼å­æ•¸çš„ä¸€åŠ');
                }
            }
        });
    </script>
</body>
</html>