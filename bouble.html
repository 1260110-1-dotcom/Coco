<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ³æ³¡æ³¡å°éŠæˆ²</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
            color: white;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
            width: 100%;
            max-width: 1000px;
            position: relative;
            overflow: hidden;
        }

        .game-header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
            z-index: 2;
        }

        h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            background: linear-gradient(90deg, #ff9a9e, #fad0c4, #fad0c4, #a1c4fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 300% auto;
            animation: gradient 3s ease-in-out infinite;
        }

        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 25px;
            position: relative;
            z-index: 2;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .info-label {
            font-size: 1rem;
            opacity: 0.9;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .info-value {
            font-size: 2.5rem;
            font-weight: bold;
            min-width: 120px;
            text-align: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 10px 25px;
            border-radius: 15px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        #score {
            color: #ff9a9e;
        }

        #timeLeft {
            color: #a1c4fd;
        }

        #level {
            color: #fad0c4;
        }

        #bubblesPopped {
            color: #96f2d7;
        }

        .game-area {
            position: relative;
            width: 100%;
            height: 500px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 25px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            cursor: crosshair;
            touch-action: none;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            position: relative;
            z-index: 2;
        }

        .control-btn {
            padding: 15px 35px;
            border: none;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 180px;
            justify-content: center;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        #startBtn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        #pauseBtn {
            background: linear-gradient(135deg, #FF9800, #f57c00);
            color: white;
        }

        #restartBtn {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        #upgradeBtn {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .control-btn:active {
            transform: translateY(0) scale(0.98);
        }

        .difficulty-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 25px;
            position: relative;
            z-index: 2;
        }

        .difficulty-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .difficulty-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .instructions {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 20px;
            margin-top: 25px;
            position: relative;
            z-index: 2;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .instructions h3 {
            color: #fad0c4;
            margin-bottom: 15px;
            font-size: 1.3rem;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .instructions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .instruction-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instruction-icon {
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .powerups {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        .powerup {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            min-width: 120px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .powerup.active {
            border-color: #ff9a9e;
            box-shadow: 0 0 20px rgba(255, 154, 158, 0.5);
            transform: scale(1.05);
        }

        .powerup-icon {
            font-size: 2rem;
        }

        .powerup-name {
            font-size: 0.9rem;
            text-align: center;
        }

        .powerup-count {
            font-size: 1.2rem;
            font-weight: bold;
            color: #a1c4fd;
        }

        .bubble {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s ease;
            box-shadow: 
                inset 0 -10px 20px rgba(255, 255, 255, 0.3),
                inset 0 10px 20px rgba(255, 255, 255, 0.1),
                0 5px 15px rgba(0, 0, 0, 0.3);
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.4));
            overflow: hidden;
        }

        .bubble::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 25%;
            width: 20%;
            height: 20%;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            filter: blur(2px);
        }

        .bubble.popped {
            animation: pop 0.3s ease-out forwards;
        }

        @keyframes pop {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(0); opacity: 0; }
        }

        .combo-indicator {
            position: absolute;
            font-size: 2rem;
            font-weight: bold;
            color: #ff9a9e;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(1.5); opacity: 0; }
        }

        .game-status {
            text-align: center;
            min-height: 60px;
            position: relative;
            z-index: 2;
        }

        #statusMessage {
            font-size: 1.5rem;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 15px;
            display: inline-block;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 154, 158, 0.3); }
            50% { box-shadow: 0 0 40px rgba(255, 154, 158, 0.6); }
        }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            border-radius: 30px;
            display: none;
        }

        .game-over h2 {
            font-size: 4rem;
            color: #ff9a9e;
            margin-bottom: 20px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .game-over p {
            font-size: 2rem;
            margin-bottom: 30px;
            color: #a1c4fd;
        }

        .background-bubbles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .background-bubble {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .game-area {
                height: 400px;
            }
            
            .controls {
                flex-wrap: wrap;
            }
            
            .control-btn {
                min-width: 140px;
                padding: 12px 25px;
            }
            
            .info-value {
                min-width: 80px;
                font-size: 2rem;
                padding: 8px 15px;
            }
            
            .instructions-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }
            
            .game-area {
                height: 300px;
            }
            
            .control-btn {
                width: 100%;
            }
            
            .info-value {
                font-size: 1.5rem;
                min-width: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>ğŸˆ æˆ³æ³¡æ³¡å¤§æŒ‘æˆ° ğŸˆ</h1>
        </div>

        <div class="game-info">
            <div class="info-item">
                <div class="info-label">åˆ†æ•¸</div>
                <div class="info-value" id="score">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">å‰©é¤˜æ™‚é–“</div>
                <div class="info-value" id="timeLeft">60</div>
            </div>
            <div class="info-item">
                <div class="info-label">é—œå¡</div>
                <div class="info-value" id="level">1</div>
            </div>
            <div class="info-item">
                <div class="info-label">æ³¡æ³¡æ•¸</div>
                <div class="info-value" id="bubblesPopped">0</div>
            </div>
        </div>

        <div class="difficulty-selector">
            <button class="difficulty-btn active" data-difficulty="easy">ç°¡å–®æ¨¡å¼</button>
            <button class="difficulty-btn" data-difficulty="normal">æ™®é€šæ¨¡å¼</button>
            <button class="difficulty-btn" data-difficulty="hard">å›°é›£æ¨¡å¼</button>
            <button class="difficulty-btn" data-difficulty="expert">å°ˆå®¶æ¨¡å¼</button>
        </div>

        <div class="powerups">
            <div class="powerup" id="freezePowerup">
                <div class="powerup-icon">â„ï¸</div>
                <div class="powerup-name">æ™‚é–“æš«åœ</div>
                <div class="powerup-count" id="freezeCount">3</div>
            </div>
            <div class="powerup" id="bombPowerup">
                <div class="powerup-icon">ğŸ’£</div>
                <div class="powerup-name">æ³¡æ³¡ç‚¸å½ˆ</div>
                <div class="powerup-count" id="bombCount">3</div>
            </div>
            <div class="powerup" id="doublePowerup">
                <div class="powerup-icon">â­</div>
                <div class="powerup-name">é›™å€åˆ†æ•¸</div>
                <div class="powerup-count" id="doubleCount">3</div>
            </div>
            <div class="powerup" id="slowPowerup">
                <div class="powerup-icon">ğŸŒ</div>
                <div class="powerup-name">æ³¡æ³¡æ¸›é€Ÿ</div>
                <div class="powerup-count" id="slowCount">3</div>
            </div>
        </div>

        <div class="game-area" id="gameArea">
            <!-- æ³¡æ³¡æœƒåœ¨é€™è£¡ç”Ÿæˆ -->
            <div class="background-bubbles" id="backgroundBubbles"></div>
        </div>

        <div class="controls">
            <button class="control-btn" id="startBtn">
                <span>â–¶ï¸</span> é–‹å§‹éŠæˆ²
            </button>
            <button class="control-btn" id="pauseBtn">
                <span>â¸ï¸</span> æš«åœéŠæˆ²
            </button>
            <button class="control-btn" id="restartBtn">
                <span>ğŸ”„</span> é‡æ–°é–‹å§‹
            </button>
            <button class="control-btn" id="upgradeBtn">
                <span>âš¡</span> å‡ç´šæŠ€èƒ½
            </button>
        </div>

        <div class="game-status">
            <div id="statusMessage">é»æ“Šã€Œé–‹å§‹éŠæˆ²ã€ä¾†æŒ‘æˆ°ï¼</div>
        </div>

        <div class="game-over" id="gameOverScreen">
            <h2 id="gameOverTitle">éŠæˆ²çµæŸï¼</h2>
            <p>æœ€çµ‚åˆ†æ•¸: <span id="finalScore">0</span></p>
            <button class="control-btn" id="playAgainBtn">
                <span>ğŸ®</span> å†ç©ä¸€æ¬¡
            </button>
        </div>

        <div class="instructions">
            <h3>ğŸ® éŠæˆ²èªªæ˜èˆ‡æŠ€å·§</h3>
            <div class="instructions-grid">
                <div class="instruction-item">
                    <div class="instruction-icon">ğŸ¯</div>
                    <div>
                        <strong>éŠæˆ²ç›®æ¨™</strong><br>
                        åœ¨æ™‚é–“å…§æˆ³ç ´è¶Šå¤šæ³¡æ³¡ï¼Œç²å¾—è¶Šé«˜åˆ†æ•¸ï¼
                    </div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-icon">ğŸ‘†</div>
                    <div>
                        <strong>åŸºæœ¬æ“ä½œ</strong><br>
                        é»æ“Š/è§¸ç¢°æ³¡æ³¡å³å¯æˆ³ç ´ï¼Œä¸åŒé¡è‰²æœ‰ä¸åŒåˆ†æ•¸
                    </div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-icon">ğŸ’¥</div>
                    <div>
                        <strong>ç‰¹æ®Šæ³¡æ³¡</strong><br>
                        é‡‘è‰²æ³¡æ³¡ï¼šé›™å€åˆ†æ•¸<br>
                        ç´…è‰²æ³¡æ³¡ï¼šæ™‚é–“æ¸›å°‘<br>
                        é»‘è‰²æ³¡æ³¡ï¼šéŠæˆ²çµæŸ
                    </div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-icon">âš¡</div>
                    <div>
                        <strong>é€£çºŒæˆ³ç ´</strong><br>
                        é€£çºŒæˆ³ç ´æ³¡æ³¡å¯ç²å¾—é€£æ“Šçå‹µï¼Œåˆ†æ•¸åŠ å€ï¼
                    </div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-icon">ğŸ</div>
                    <div>
                        <strong>é“å…·ä½¿ç”¨</strong><br>
                        é»æ“Šé“å…·åœ–æ¨™ä¾†ä½¿ç”¨ç‰¹æ®Šèƒ½åŠ›ï¼Œå¹«åŠ©ä½ ç²å¾—æ›´é«˜åˆ†æ•¸
                    </div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-icon">ğŸ†</div>
                    <div>
                        <strong>é«˜åˆ†æŠ€å·§</strong><br>
                        ç„æº–é‡‘è‰²æ³¡æ³¡ï¼Œé¿é–‹é»‘è‰²æ³¡æ³¡ï¼Œä¿æŒé€£æ“Šä¸æ–·ï¼
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // éŠæˆ²é…ç½®
        const CONFIG = {
            difficulties: {
                easy: { time: 90, bubbleSpeed: 1, spawnRate: 800, blackBubbleChance: 0.02 },
                normal: { time: 60, bubbleSpeed: 1.5, spawnRate: 600, blackBubbleChance: 0.05 },
                hard: { time: 45, bubbleSpeed: 2, spawnRate: 400, blackBubbleChance: 0.08 },
                expert: { time: 30, bubbleSpeed: 2.5, spawnRate: 300, blackBubbleChance: 0.12 }
            },
            bubbleTypes: [
                { color: 'rgba(255, 255, 255, 0.9)', points: 10, rarity: 30 },  // ç™½è‰²æ³¡æ³¡
                { color: 'rgba(173, 216, 230, 0.9)', points: 20, rarity: 25 },  // æ·¡è—è‰²æ³¡æ³¡
                { color: 'rgba(144, 238, 144, 0.9)', points: 30, rarity: 20 },  // æ·¡ç¶ è‰²æ³¡æ³¡
                { color: 'rgba(255, 182, 193, 0.9)', points: 40, rarity: 15 },  // ç²‰ç´…è‰²æ³¡æ³¡
                { color: 'rgba(255, 215, 0, 0.9)', points: 100, rarity: 5 },    // é‡‘è‰²æ³¡æ³¡ï¼ˆé«˜åˆ†ï¼‰
                { color: 'rgba(255, 69, 0, 0.9)', points: -30, rarity: 3 },     // ç´…è‰²æ³¡æ³¡ï¼ˆæ‰£åˆ†ï¼‰
                { color: 'rgba(0, 0, 0, 0.9)', points: -9999, rarity: 2 },      // é»‘è‰²æ³¡æ³¡ï¼ˆéŠæˆ²çµæŸï¼‰
                { color: 'rgba(147, 112, 219, 0.9)', points: 50, rarity: 8 },   // ç´«è‰²æ³¡æ³¡
                { color: 'rgba(255, 105, 180, 0.9)', points: 60, rarity: 6 }    // ç†±ç²‰è‰²æ³¡æ³¡
            ],
            powerups: {
                freeze: { count: 3, duration: 5000, icon: 'â„ï¸', name: 'æ™‚é–“æš«åœ' },
                bomb: { count: 3, radius: 150, icon: 'ğŸ’£', name: 'æ³¡æ³¡ç‚¸å½ˆ' },
                double: { count: 3, duration: 10000, icon: 'â­', name: 'é›™å€åˆ†æ•¸' },
                slow: { count: 3, duration: 8000, icon: 'ğŸŒ', name: 'æ³¡æ³¡æ¸›é€Ÿ' }
            }
        };

        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            score: 0,
            timeLeft: 60,
            level: 1,
            bubblesPopped: 0,
            gameActive: false,
            gamePaused: false,
            difficulty: 'easy',
            combo: 0,
            maxCombo: 0,
            comboTimeout: null,
            bubbles: [],
            powerups: { ...CONFIG.powerups },
            activeEffects: {
                doubleScore: false,
                timeFreeze: false,
                slowMotion: false
            },
            spawnInterval: null,
            gameLoop: null,
            lastSpawnTime: 0,
            upgradeLevel: 1,
            highScore: localStorage.getItem('bubbleHighScore') || 0
        };

        // DOM å…ƒç´ 
        const gameArea = document.getElementById('gameArea');
        const scoreElement = document.getElementById('score');
        const timeLeftElement = document.getElementById('timeLeft');
        const levelElement = document.getElementById('level');
        const bubblesPoppedElement = document.getElementById('bubblesPopped');
        const statusMessage = document.getElementById('statusMessage');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreElement = document.getElementById('finalScore');
        const backgroundBubbles = document.getElementById('backgroundBubbles');

        // åˆå§‹åŒ–èƒŒæ™¯æ³¡æ³¡
        function initBackgroundBubbles() {
            backgroundBubbles.innerHTML = '';
            for (let i = 0; i < 20; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'background-bubble';
                const size = Math.random() * 80 + 20;
                const x = Math.random() * 100;
                const duration = Math.random() * 30 + 20;
                
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = `${x}%`;
                bubble.style.animationDuration = `${duration}s`;
                bubble.style.animationDelay = `${Math.random() * 5}s`;
                
                backgroundBubbles.appendChild(bubble);
            }
        }

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            // é‡ç½®éŠæˆ²ç‹€æ…‹
            gameState.score = 0;
            gameState.level = 1;
            gameState.bubblesPopped = 0;
            gameState.combo = 0;
            gameState.maxCombo = 0;
            gameState.timeLeft = CONFIG.difficulties[gameState.difficulty].time;
            gameState.gameActive = false;
            gameState.gamePaused = false;
            gameState.activeEffects = {
                doubleScore: false,
                timeFreeze: false,
                slowMotion: false
            };
            
            // é‡ç½®é“å…·æ•¸é‡
            gameState.powerups = { ...CONFIG.powerups };
            updatePowerupDisplays();
            
            // æ¸…é™¤æ‰€æœ‰æ³¡æ³¡
            gameState.bubbles.forEach(bubble => {
                if (bubble.element) {
                    bubble.element.remove();
                }
            });
            gameState.bubbles = [];
            
            // æ¸…é™¤è¨ˆæ™‚å™¨
            if (gameState.spawnInterval) {
                clearInterval(gameState.spawnInterval);
            }
            if (gameState.gameLoop) {
                cancelAnimationFrame(gameState.gameLoop);
            }
            
            // éš±è—éŠæˆ²çµæŸç•«é¢
            gameOverScreen.style.display = 'none';
            
            // æ›´æ–°é¡¯ç¤º
            updateDisplay();
            statusMessage.textContent = 'æº–å‚™å¥½äº†å—ï¼Ÿé»æ“Šé–‹å§‹éŠæˆ²ï¼';
            statusMessage.style.color = '#a1c4fd';
        }

        // é–‹å§‹éŠæˆ²
        function startGame() {
            if (gameState.gameActive) return;
            
            gameState.gameActive = true;
            gameState.gamePaused = false;
            gameState.timeLeft = CONFIG.difficulties[gameState.difficulty].time;
            
            // é–‹å§‹éŠæˆ²å¾ªç’°
            gameState.lastSpawnTime = Date.now();
            gameState.spawnInterval = setInterval(spawnBubble, CONFIG.difficulties[gameState.difficulty].spawnRate);
            gameLoop();
            
            statusMessage.textContent = 'éŠæˆ²é€²è¡Œä¸­ï¼å¿«é»æˆ³ç ´æ³¡æ³¡ï¼';
            statusMessage.style.color = '#96f2d7';
        }

        // æš«åœ/ç¹¼çºŒéŠæˆ²
        function togglePause() {
            if (!gameState.gameActive) return;
            
            gameState.gamePaused = !gameState.gamePaused;
            
            if (gameState.gamePaused) {
                clearInterval(gameState.spawnInterval);
                statusMessage.textContent = 'éŠæˆ²æš«åœä¸­...';
                statusMessage.style.color = '#ff9a9e';
            } else {
                gameState.spawnInterval = setInterval(spawnBubble, CONFIG.difficulties[gameState.difficulty].spawnRate);
                statusMessage.textContent = 'éŠæˆ²ç¹¼çºŒï¼';
                statusMessage.style.color = '#96f2d7';
                gameLoop();
            }
        }

        // ç”Ÿæˆæ³¡æ³¡
        function spawnBubble() {
            if (gameState.gamePaused || !gameState.gameActive) return;
            
            const bubbleSize = Math.random() * 60 + 40;
            const x = Math.random() * (gameArea.offsetWidth - bubbleSize);
            const speed = CONFIG.difficulties[gameState.difficulty].bubbleSpeed * 
                         (gameState.activeEffects.slowMotion ? 0.5 : 1);
            
            // é¸æ“‡æ³¡æ³¡é¡å‹ï¼ˆæ ¹æ“šæ©Ÿç‡ï¼‰
            let bubbleType;
            const totalRarity = CONFIG.bubbleTypes.reduce((sum, type) => sum + type.rarity, 0);
            let random = Math.random() * totalRarity;
            
            for (const type of CONFIG.bubbleTypes) {
                random -= type.rarity;
                if (random <= 0) {
                    bubbleType = type;
                    break;
                }
            }
            
            // å‰µå»ºæ³¡æ³¡å…ƒç´ 
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.style.width = `${bubbleSize}px`;
            bubble.style.height = `${bubbleSize}px`;
            bubble.style.left = `${x}px`;
            bubble.style.top = `${gameArea.offsetHeight}px`;
            bubble.style.background = bubbleType.color;
            bubble.style.border = `3px solid ${bubbleType.color.replace('0.9', '0.7')}`;
            
            // æ·»åŠ é–ƒå…‰æ•ˆæœ
            const shine = document.createElement('div');
            shine.style.position = 'absolute';
            shine.style.top = '15%';
            shine.style.left = '25%';
            shine.style.width = '20%';
            shine.style.height = '20%';
            shine.style.background = 'rgba(255, 255, 255, 0.6)';
            shine.style.borderRadius = '50%';
            shine.style.filter = 'blur(2px)';
            bubble.appendChild(shine);
            
            // æ·»åŠ é»æ“Šäº‹ä»¶
            bubble.addEventListener('click', () => popBubble(bubble, bubbleType));
            bubble.addEventListener('touchstart', (e) => {
                e.preventDefault();
                popBubble(bubble, bubbleType);
            });
            
            gameArea.appendChild(bubble);
            
            // å„²å­˜æ³¡æ³¡è³‡æ–™
            gameState.bubbles.push({
                element: bubble,
                type: bubbleType,
                speed: speed,
                x: x,
                y: gameArea.offsetHeight,
                size: bubbleSize
            });
            
            // é™åˆ¶æ³¡æ³¡æ•¸é‡
            if (gameState.bubbles.length > 50) {
                const oldestBubble = gameState.bubbles.shift();
                if (oldestBubble.element) {
                    oldestBubble.element.remove();
                }
            }
        }

        // æˆ³ç ´æ³¡æ³¡
        function popBubble(bubbleElement, bubbleType) {
            if (!gameState.gameActive || gameState.gamePaused) return;
            
            // ç§»é™¤æ³¡æ³¡
            bubbleElement.classList.add('popped');
            
            // æ›´æ–°é€£æ“Š
            updateCombo();
            
            // è¨ˆç®—åˆ†æ•¸ï¼ˆè€ƒæ…®é›™å€åˆ†æ•¸æ•ˆæœï¼‰
            let points = bubbleType.points;
            if (gameState.activeEffects.doubleScore && points > 0) {
                points *= 2;
            }
            
            // æ›´æ–°éŠæˆ²ç‹€æ…‹
            gameState.score += points;
            gameState.bubblesPopped++;
            
            // é¡¯ç¤ºå¾—åˆ†æ•ˆæœ
            showScoreEffect(bubbleElement, points);
            
            // ç§»é™¤æ³¡æ³¡è³‡æ–™
            const bubbleIndex = gameState.bubbles.findIndex(b => b.element === bubbleElement);
            if (bubbleIndex > -1) {
                gameState.bubbles.splice(bubbleIndex, 1);
            }
            
            // ç‰¹æ®Šæ³¡æ³¡æ•ˆæœ
            handleSpecialBubble(bubbleType);
            
            // æ›´æ–°é¡¯ç¤º
            updateDisplay();
            
            // æ’­æ”¾éŸ³æ•ˆ
            playPopSound();
            
            // æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸï¼ˆé»‘è‰²æ³¡æ³¡ï¼‰
            if (bubbleType.points === -9999) {
                gameOver();
                return;
            }
            
            // ç§»é™¤æ³¡æ³¡å…ƒç´ 
            setTimeout(() => {
                if (bubbleElement.parentNode) {
                    bubbleElement.remove();
                }
            }, 300);
        }

        // è™•ç†ç‰¹æ®Šæ³¡æ³¡æ•ˆæœ
        function handleSpecialBubble(bubbleType) {
            if (bubbleType.points === -30) { // ç´…è‰²æ³¡æ³¡ï¼šæ¸›å°‘æ™‚é–“
                gameState.timeLeft = Math.max(5, gameState.timeLeft - 5);
                showStatusMessage('æ™‚é–“æ¸›å°‘5ç§’ï¼', '#ff6b6b');
            }
        }

        // æ›´æ–°é€£æ“Šç³»çµ±
        function updateCombo() {
            gameState.combo++;
            gameState.maxCombo = Math.max(gameState.maxCombo, gameState.combo);
            
            // é¡¯ç¤ºé€£æ“Šæ•ˆæœ
            if (gameState.combo > 1) {
                showComboEffect(gameState.combo);
            }
            
            // é‡ç½®é€£æ“Šè¨ˆæ™‚å™¨
            if (gameState.comboTimeout) {
                clearTimeout(gameState.comboTimeout);
            }
            
            gameState.comboTimeout = setTimeout(() => {
                if (gameState.combo >= 5) {
                    const bonus = gameState.combo * 10;
                    gameState.score += bonus;
                    showStatusMessage(`é€£æ“Š${gameState.combo}æ¬¡ï¼çå‹µ+${bonus}åˆ†`, '#ff9a9e');
                }
                gameState.combo = 0;
            }, 2000);
        }

        // é¡¯ç¤ºå¾—åˆ†æ•ˆæœ
        function showScoreEffect(element, points) {
            const effect = document.createElement('div');
            effect.className = 'combo-indicator';
            effect.textContent = points > 0 ? `+${points}` : points;
            effect.style.left = `${element.offsetLeft + element.offsetWidth / 2}px`;
            effect.style.top = `${element.offsetTop}px`;
            effect.style.color = points > 0 ? '#96f2d7' : '#ff6b6b';
            
            gameArea.appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 1000);
        }

        // é¡¯ç¤ºé€£æ“Šæ•ˆæœ
        function showComboEffect(combo) {
            const effect = document.createElement('div');
            effect.className = 'combo-indicator';
            effect.textContent = `COMBO x${combo}!`;
            effect.style.left = '50%';
            effect.style.top = '50%';
            effect.style.transform = 'translate(-50%, -50%)';
            effect.style.fontSize = `${Math.min(3, 1 + combo * 0.2)}rem`;
            effect.style.color = '#ff9a9e';
            
            gameArea.appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 1000);
        }

        // é¡¯ç¤ºç‹€æ…‹è¨Šæ¯
        function showStatusMessage(message, color) {
            statusMessage.textContent = message;
            statusMessage.style.color = color;
            
            setTimeout(() => {
                if (gameState.gameActive && !gameState.gamePaused) {
                    statusMessage.textContent = 'éŠæˆ²é€²è¡Œä¸­ï¼å¿«é»æˆ³ç ´æ³¡æ³¡ï¼';
                    statusMessage.style.color = '#96f2d7';
                }
            }, 2000);
        }

        // éŠæˆ²å¾ªç’°
        function gameLoop() {
            if (gameState.gamePaused || !gameState.gameActive) return;
            
            // æ›´æ–°æ™‚é–“
            if (!gameState.activeEffects.timeFreeze) {
                gameState.timeLeft -= 0.016; // ç´„60fps
               